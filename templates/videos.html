<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Video List</title>
		<link rel="icon" type="image/svg+xml"
			href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%234267B2'/><text x='50%' y='70%' font-size='70' fill='white' text-anchor='middle' font-family='Arial'>{{ app_name[0]|upper }}</text></svg>">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
		<!-- Add Font Awesome -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		<style>
			/* Ensure word wrap in the title column */
			.table td,
			.table th {
				white-space: normal !important;
			}

			.table th:nth-child(3) {
				width: 120px;
			}

			/* Adjust the width of the path column */
			.table td:nth-child(4) {
				width: 200px;
				word-wrap: break-word;
				white-space: normal !important;
			}
		</style>
	</head>
	<body>
		{% include 'header.html' %}
		{% include 'message.html' %}
		<div class="container mt-5">
			<h1 class="text-center mb-4">Video Playlist List</h1>

			<!-- Download All Button with icon -->
			<form method="POST" action="{{ url_for('video.download_all_videos') }}" class="mt-4">
				{{ form.csrf_token }} <!-- CSRF token -->
				<button type="submit" class="btn btn-danger">
					<i class="fas fa-download"></i> Download All Videos
				</button>
			</form>

			<form method="POST" action="{{ url_for('video.split_selected_videos') }}" class="mt-4">
				{{ form.csrf_token }} <!-- CSRF token -->
				<select name="split_duration" class="form-select">
					<option value="60" {% if selected_duration == 60 %}selected{% endif %}>1 minute</option>
					<option value="180" {% if selected_duration == 180 %}selected{% endif %}>3 minutes</option>
					<option value="300" {% if selected_duration == 300 %}selected{% endif %}>5 minutes</option>
					<option value="600" {% if selected_duration == 600 %}selected{% endif %}>10 minutes</option>
					<option value="1800" {% if selected_duration == 1800 %}selected{% endif %}>30 minutes</option>
					<option value="3600" {% if selected_duration == 3600 %}selected{% endif %}>1 hours</option>
					<option value="7200" {% if selected_duration == 7200 %}selected{% endif %}>2 hours</option>
				</select>
				<button type="submit" class="btn btn-warning mt-2">Split Selected Videos</button>
				<!-- List of videos to split will be sent here -->
				<div class="mt-2">
					<h3 class="mt-5">Video List</h3>
					<table class="table table-bordered mt-3">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>Playlist ID</th>
								<th>Duration</th>
								<th>Name</th>
								<th>Path</th>
								<th>Download Video</th>
								<th>Split TikTok</th> <!-- New Split Column -->
								<th>Select</th> <!-- Select Video Column -->
							</tr>
						</thead>
						<tbody>
							<form></form>
							{% for video in videos %}
							<tr>
								<td>{{ video.id }}</td>
								<td>{{ video.playlist_id }}</td>
								<td data-duration="{{ video.duration if video.duration else '' }}">
									{{ video.duration if video.duration else 'No info' }}
								</td>
								<td>{{ video.title}}</td>
								<td>{{ video.path if video.path else 'No path available' }}</td>
								{% if not video.crawled %}
								<td>
									<form method="GET" id="download_form_request_{{ video.video_id }}"
										action="{{ url_for('video.download_video_route', video_id=video.video_id) }}">
										<button type="submit" form="download_form_request_{{ video.video_id }}" class="btn btn-success">
											<i class="fas fa-download"></i> Download Video
										</button>
									</form>
								</td>
								{% else %}
								<td class="text-center">
									<span class="text-success">Downloaded</span>
								</td>
								{% endif %}
								<!-- Split Video Button -->
								{% if video.path %}
								<td>
									<form method="POST" id="split_form_request_{{ video.video_id }}"
										action="{{ url_for('video.split_video_route', video_id=video.video_id) }}">
										{{ form.csrf_token }} <!-- CSRF token -->
										<button type="submit" form="split_form_request_{{ video.video_id }}" class="btn btn-warning">Split
											Video</button>
									</form>
								</td>
								{% else %}
								<td class="text-center">
									<span class="text-muted">--</span>
								</td>
								{% endif %}
								<!-- Video Selection Checkbox -->
								<td>
									<input type="checkbox" name="selected_videos" value="{{ video.id }}">
								</td>
							</tr>
							{% else %}
							<tr>
								<td colspan="7" class="text-center">No videos to display.</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</form>
			{% if pagination.pages > 1 %}
			<nav aria-label="Video list pagination" class="mt-3">
				<ul class="pagination justify-content-center">
					{% if pagination.has_prev %}
					<li class="page-item">
						<a class="page-link"
							href="{{ url_for('video.index', page=pagination.prev_num, playlist_id_filter=request.args.get('playlist_id_filter')) }}">Previous</a>
					</li>
					{% endif %}

					{% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
					{% if page_num %}
					{% if page_num == pagination.page %}
					<li class="page-item active">
						<span class="page-link">{{ page_num }}</span>
					</li>
					{% else %}
					<li class="page-item">
						<a class="page-link"
							href="{{ url_for('video.index', page=page_num, playlist_id_filter=request.args.get('playlist_id_filter')) }}">{{ page_num }}</a>
					</li>
					{% endif %}
					{% else %}
					<li class="page-item disabled">
						<span class="page-link">...</span>
					</li>
					{% endif %}
					{% endfor %}

					{% if pagination.has_next %}
					<li class="page-item">
						<a class="page-link"
							href="{{ url_for('video.index', page=pagination.next_num, playlist_id_filter=request.args.get('playlist_id_filter')) }}">Next</a>
					</li>
					{% endif %}
				</ul>
			</nav>
			{% endif %}
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-OgVRvuATP1z7JjHLkuOU63t63E9UK9R1DlmAy1UoZlZpkjr/ZpZqgs3bzAv29ZjX"
			crossorigin="anonymous"></script>

	</body>
</html>